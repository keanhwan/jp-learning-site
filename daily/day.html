<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>일일 학습</title>
  <link rel="stylesheet" href="../assets/css/site.css?v=2025-08">
</head>
<body>
  <header>
    <nav>
      <a href="../index.html">홈</a> |
      <a href="index.html">1달 플랜</a>
    </nav>
    <h1 id="day-title">Day</h1>
  </header>
  <main>
    <section id="words-section">
      <h2>단어</h2>
      <ul id="words-list"></ul>
    </section>
    <section id="pattern-section">
      <h2>패턴</h2>
      <p id="pattern-jp"></p>
      <p id="pattern-ko"></p>
    </section>
    <button id="btn-today-quiz">오늘 퀴즈</button>
  </main>
  <script src="../assets/js/app.js?v=2025-08"></script>
  <script>
    // URL 파라미터 추출
    function getParam(name) {
      return new URLSearchParams(window.location.search).get(name);
    }
    jpApp.loadDailyPlan(plan => {
      const index = parseInt(getParam('d') || '1') - 1;
      if (index < 0 || index >= plan.length) {
        document.getElementById('day-title').textContent = '잘못된 Day';
        return;
      }
      const day = plan[index];
      document.getElementById('day-title').textContent = 'Day ' + (index + 1) + ': ' + day.title;
      const list = document.getElementById('words-list');
      day.words.forEach((w, wi) => {
        const li = document.createElement('li');
        li.textContent = w.jp + ' - ' + w.ko;
        const btn = document.createElement('button');
        btn.textContent = '읽어주기';
        btn.onclick = () => {
          // TTS가 안 되면 오디오 파일 재생 (현재 미포함)
          if (!jpApp.speakJA(w.jp)) {
            const audioSrc = '../assets/audio/' + (w.audio || '');
            jpApp.playAudio(audioSrc);
          }
        };
        li.appendChild(btn);
        list.appendChild(li);
      });
      document.getElementById('pattern-jp').textContent = day.pattern;
      document.getElementById('pattern-ko').textContent = day.pattern_ko;
      document.getElementById('btn-today-quiz').onclick = () => {
        const itemIds = [];
        day.words.forEach((w, wi) => {
          const id = `D${index + 1}W${wi + 1}`;
          itemIds.push(id);
          jpApp.logStudy({ itemId: id, itemType: 'word', outcome: 'view' });
        });
        const pid = `D${index + 1}P`;
        itemIds.push(pid);
        jpApp.logStudy({ itemId: pid, itemType: 'pattern', outcome: 'view' });
        jpApp.startQuiz(itemIds);
      };
    });
  </script>
</body>
</html>